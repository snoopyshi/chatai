<template>
  <div class="dark">
    <div class="home_container">
      <div class="home_sidebar false">
        <div class="home_sidebar-header__4CGS6">
          <div class="home_sidebar-title__hO8AU">史努比 聊天 GPT</div>
        </div>
        <div class="home_sidebar-header-bar__Yb2mm">
          <div
            class="button_icon-button___a_E9 button_border__8t_DM button_shadow__kLcUJ home_sidebar-bar-button__r0IoJ clickable undefined"
            role="button">
            <div class="button_icon-button-icon__3y7OZ false"><svg width="16" height="16" viewBox="0 0 48 48" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <circle cx="24" cy="12" r="8" stroke="#333" stroke-width="4" stroke-linecap="round"
                  stroke-linejoin="round">
                </circle>
                <path d="M42 44c0-9.941-8.059-18-18-18S6 34.059 6 44" stroke="#333" stroke-width="4"
                  stroke-linecap="round" stroke-linejoin="round"></path>
              </svg></div>
            <div class="button_icon-button-text__m50dB">个人中心</div>
          </div>
          <div
            class="button_icon-button___a_E9 button_border__8t_DM button_shadow__kLcUJ home_sidebar-bar-button__r0IoJ clickable undefined"
            role="button">
            <div class="button_icon-button-icon__3y7OZ false"><svg width="16" height="16" viewBox="0 0 48 48" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path d="M39 32H13L8 12h36l-5 20Z"></path>
                <path d="M3 6h3.5L8 12m0 0 5 20h26l5-20H8Z" stroke="red" stroke-width="4" stroke-linecap="round"
                  stroke-linejoin="round"></path>
                <circle cx="13" cy="39" r="3" stroke="red" stroke-width="4" stroke-linecap="round"
                  stroke-linejoin="round">
                </circle>
                <circle cx="39" cy="39" r="3" stroke="red" stroke-width="4" stroke-linecap="round"
                  stroke-linejoin="round">
                </circle>
              </svg></div>
            <div class="button_icon-button-text__m50dB">会员中心</div>
          </div>
        </div>
        <div class="home_sidebar-body__lNoun">
          <div>
            <div class="home_chat-item__3ywJm home_chat-item-selected__wANJZ">
              <div class="home_chat-item-title__3eQum">新的聊天</div>
              <div class="home_chat-item-info__hF1sb">
                <div>1 条对话</div>
                <div>8/21/2023, 1:34:28 AM</div>
              </div>
              <div class="home_chat-item-delete__wP_fX"><svg xmlns="http://www.w3.org/2000/svg" fill="none" width="14.663"
                  height="14.663">
                  <g>
                    <path
                      d="M7.337.667c-3.69 0-6.67 2.98-6.67 6.67a6.66 6.66 0 0 0 6.67 6.66c3.68 0 6.66-2.98 6.66-6.66a6.66 6.66 0 0 0-6.66-6.67Z"
                      fill-rule="evenodd" fill="#D8D8D8" fill-opacity="0.01"></path>
                    <path
                      d="m10.138 5.471-4.667 4.667q-.046.046-.1.083-.055.036-.116.062-.06.025-.125.038-.064.012-.13.012t-.13-.012q-.064-.013-.125-.038-.06-.026-.115-.062-.055-.037-.101-.083-.047-.046-.083-.101-.037-.055-.062-.115-.025-.06-.038-.125-.013-.065-.013-.13 0-.066.013-.13.013-.065.038-.125.025-.061.062-.116.036-.054.083-.1l4.666-4.667q.047-.047.101-.083.055-.037.116-.062.06-.025.125-.038.064-.013.13-.013.065 0 .13.013.064.013.125.038.06.025.115.062.055.036.101.083.046.046.083.1.036.055.062.116.025.06.038.125.012.064.012.13t-.012.13q-.013.064-.038.125-.026.06-.062.115-.037.055-.083.101ZM5.471 4.53l.667.666q.046.047.083.101.036.055.062.116.025.06.038.125.012.064.012.13 0 .065-.012.13-.013.064-.038.125-.026.06-.062.115-.036.055-.083.101-.046.046-.1.083-.056.036-.116.062-.06.025-.125.038-.065.012-.13.012-.066 0-.13-.012-.065-.013-.125-.038-.061-.026-.116-.062-.054-.036-.1-.083l-.667-.667q-.047-.046-.083-.1-.037-.055-.062-.116-.025-.06-.038-.125-.013-.064-.013-.13t.013-.13q.013-.064.038-.125.025-.06.062-.115.036-.055.083-.101.046-.047.1-.083.055-.037.116-.062.06-.025.125-.038.064-.013.13-.013t.13.013q.064.013.125.038.06.025.115.062.055.036.101.083Zm4 4 .667.666q.046.047.083.101.036.055.062.116.025.06.038.125.012.064.012.13 0 .065-.012.13-.013.064-.038.125-.026.06-.062.115-.036.055-.083.101-.046.046-.1.083-.056.036-.116.062-.06.025-.125.038-.065.012-.13.012-.066 0-.13-.012-.065-.013-.125-.038-.061-.026-.116-.062-.054-.036-.1-.083l-.667-.667q-.047-.046-.083-.1-.037-.055-.062-.116-.025-.06-.038-.125-.013-.064-.013-.13t.013-.13q.013-.064.038-.125.025-.06.062-.115.036-.055.083-.101.046-.047.1-.083.055-.037.116-.062.06-.025.125-.038.064-.013.13-.013t.13.013q.064.013.125.038.06.025.115.062.055.036.101.083Zm3.859-1.192q0-2.491-1.755-4.248-1.754-1.756-4.238-1.756-2.492 0-4.248 1.756-1.756 1.756-1.756 4.248 0 2.484 1.756 4.238 1.757 1.755 4.248 1.755 2.484 0 4.238-1.755 1.755-1.754 1.755-4.238Zm1.333 0q0 3.036-2.145 5.181t-5.181 2.145q-3.043 0-5.19-2.145Q0 10.374 0 7.337q0-3.044 2.147-5.19Q4.293 0 7.337 0q3.037 0 5.181 2.147 2.145 2.147 2.145 5.19ZM10.332 5q0 .066-.013.13t-.038.125q-.025.06-.061.114-.037.055-.083.101-.046.047-.1.083-.055.036-.116.061-.06.025-.125.038-.064.013-.13.013-.065 0-.13-.013-.063-.013-.124-.038-.06-.025-.115-.061-.054-.036-.1-.083-.047-.046-.083-.1-.037-.055-.062-.115-.025-.061-.038-.125-.012-.064-.012-.13 0-.065.012-.13.013-.064.038-.124.025-.061.062-.115.036-.055.082-.101.047-.047.101-.083.055-.036.115-.061.06-.025.125-.038.064-.013.13-.013.065 0 .13.013.064.013.124.038t.115.061q.055.036.1.083.047.046.084.1.036.055.061.116.025.06.038.124.013.065.013.13ZM5.665 9.667q0 .065-.013.13-.013.064-.038.124t-.061.115q-.036.055-.083.1-.046.047-.1.084-.055.036-.116.061-.06.025-.124.038-.064.013-.13.013-.065 0-.13-.013-.064-.013-.124-.038-.061-.025-.115-.061-.055-.037-.101-.083-.047-.046-.083-.1-.036-.055-.061-.116-.025-.06-.038-.125-.013-.064-.013-.13 0-.065.013-.13.013-.063.038-.124.025-.06.061-.115.036-.054.083-.1.046-.047.1-.083.055-.037.116-.062.06-.025.124-.038.065-.012.13-.012.066 0 .13.012.064.013.124.038.061.025.115.062.055.036.101.082.047.047.083.101.036.055.061.115.025.06.038.125.013.064.013.13Zm0-4.667q0 .066-.013.13t-.038.125q-.025.06-.061.114-.036.055-.083.101-.046.047-.1.083-.055.036-.116.061-.06.025-.124.038-.064.013-.13.013-.065 0-.13-.013-.064-.013-.124-.038-.061-.025-.115-.061-.055-.036-.101-.083-.047-.046-.083-.1-.036-.055-.061-.115-.025-.061-.038-.125-.013-.064-.013-.13 0-.065.013-.13.013-.064.038-.124.025-.061.061-.115.036-.055.083-.101.046-.047.1-.083.055-.036.116-.061.06-.025.124-.038.065-.013.13-.013.066 0 .13.013t.124.038q.061.025.115.061.055.036.101.083.047.046.083.1.036.055.061.116.025.06.038.124.013.065.013.13Zm.667.667q0 .065-.013.13-.013.064-.038.124t-.061.115q-.037.055-.083.1-.046.047-.1.084-.055.036-.116.061-.06.025-.125.038-.064.013-.13.013-.065 0-.13-.013-.063-.013-.124-.038-.06-.025-.115-.061-.054-.037-.1-.083-.047-.046-.083-.1-.037-.055-.062-.116-.025-.06-.038-.125-.012-.064-.012-.13 0-.065.012-.13.013-.063.038-.124.025-.06.062-.115.036-.054.082-.1.047-.047.101-.083.055-.037.115-.062.06-.025.125-.038.064-.012.13-.012.065 0 .13.012.064.013.124.038t.115.062q.055.036.1.082.047.047.084.101.036.055.061.115.025.06.038.125.013.064.013.13ZM9.665 9q0 .066-.013.13t-.038.125q-.025.06-.061.114-.036.055-.083.101-.046.047-.1.083-.055.036-.116.061-.06.025-.124.038-.064.013-.13.013-.065 0-.13-.013-.064-.013-.124-.038-.061-.025-.115-.061-.055-.036-.101-.083-.047-.046-.083-.1-.036-.055-.061-.115-.025-.061-.038-.125-.013-.064-.013-.13 0-.065.013-.13.013-.064.038-.124.025-.061.061-.115.036-.055.083-.101.046-.047.1-.083.055-.036.116-.061.06-.025.124-.038.065-.013.13-.013.066 0 .13.013t.124.038q.061.025.115.061.055.036.101.083.047.046.083.1.036.055.061.116.025.06.038.124.013.065.013.13Zm.667.667q0 .065-.013.13-.013.064-.038.124t-.061.115q-.037.055-.083.1-.046.047-.1.084-.055.036-.116.061-.06.025-.125.038-.064.013-.13.013-.065 0-.13-.013-.063-.013-.124-.038-.06-.025-.115-.061-.054-.037-.1-.083-.047-.046-.083-.1-.037-.055-.062-.116-.025-.06-.038-.125-.012-.064-.012-.13 0-.065.012-.13.013-.063.038-.124.025-.06.062-.115.036-.054.082-.1.047-.047.101-.083.055-.037.115-.062.06-.025.125-.038.064-.012.13-.012.065 0 .13.012.064.013.124.038t.115.062q.055.036.1.082.047.047.084.101.036.055.061.115.025.06.038.125.013.064.013.13Z"
                      fill="var(--primary)"></path>
                  </g>
                </svg></div>
            </div>
          </div>
        </div>
        <div class="home_chat-item__3ywJm home_chat-item-selected__wANJZ">
          <div>
            <div class="home_chat-item-title__3eQum">当前余量</div>
            <div><span>gpt4 : 0</span>次<br><span>gpt3.5 : 278</span>次/天<br><span>AI 绘画 : 0</span>次</div>
          </div>
        </div>
        <div class="home_sidebar-tail__Cycx5">
          <div class="home_sidebar-actions__ZAHOO">
            <div class="home_sidebar-action__zwkgi home_mobile__JfFJ9">
              <div class="button_icon-button___a_E9 button_border__8t_DM button_shadow__kLcUJ  clickable undefined"
                role="button">
                <div class="button_icon-button-icon__3y7OZ false"><svg xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" fill="none">
                    <defs>
                      <path id="close_svg__a" d="M0 0h16v16H0z"></path>
                    </defs>
                    <g>
                      <mask id="close_svg__b" fill="#fff">
                        <use xlink:href="#close_svg__a"></use>
                      </mask>
                      <g mask="url(#close_svg__b)">
                        <path transform="translate(2.667 2.667)" d="m0 0 10.67 10.67M0 10.67 10.67 0"
                          style="stroke: rgb(255, 255, 255); stroke-width: 1.33333; stroke-opacity: 1; stroke-dasharray: 0, 0;">
                        </path>
                      </g>
                    </g>
                  </svg></div>
              </div>
            </div>
            <div class="home_sidebar-action__zwkgi">
              <div class="button_icon-button___a_E9 button_border__8t_DM button_shadow__kLcUJ  clickable undefined"
                role="button">
                <div class="button_icon-button-icon__3y7OZ false"><svg xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" fill="none">
                    <defs>
                      <path id="settings_svg__a" d="M0 0h16v16H0z"></path>
                    </defs>
                    <g>
                      <mask id="settings_svg__b" fill="#fff">
                        <use xlink:href="#settings_svg__a"></use>
                      </mask>
                      <g mask="url(#settings_svg__b)">
                        <path transform="translate(1.333 2.333)" d="M13.33 5.67 10 0H3.33L0 5.67l3.33 5.66H10l3.33-5.66Z"
                          style="stroke: rgb(51, 51, 51); stroke-width: 1.33333; stroke-opacity: 1; stroke-dasharray: 0, 0;">
                        </path>
                        <path transform="translate(6.333 6.333)"
                          d="M3.33 1.67C3.33.75 2.59 0 1.67 0 .75 0 0 .75 0 1.67c0 .92.75 1.66 1.67 1.66.92 0 1.66-.74 1.66-1.66Z"
                          style="stroke: rgb(51, 51, 51); stroke-width: 1.33333; stroke-opacity: 1; stroke-dasharray: 0, 0;">
                        </path>
                      </g>
                    </g>
                  </svg></div>
              </div>
            </div>
            <div class="home_sidebar-action__zwkgi">
              <div class="button_icon-button___a_E9 button_border__8t_DM button_shadow__kLcUJ  clickable undefined"
                role="button">
                <div class="button_icon-button-icon__3y7OZ false"><svg width="16" height="16" viewBox="0 0 48 48"
                    fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="4" y="15" width="40" height="26" rx="2" stroke="#333" stroke-width="4"
                      stroke-linejoin="round">
                    </rect>
                    <path d="m24 7-8 8h16l-8-8ZM12 24h18M12 32h8" stroke="#333" stroke-width="4" stroke-linecap="round"
                      stroke-linejoin="round"></path>
                  </svg></div>
              </div>
            </div>
          </div>
          <div>
            <div class="button_icon-button___a_E9 button_border__8t_DM button_shadow__kLcUJ  clickable undefined"
              role="button">
              <div class="button_icon-button-icon__3y7OZ false"><svg xmlns="http://www.w3.org/2000/svg"
                  xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" fill="none">
                  <defs>
                    <path id="add_svg__a" d="M0 0h16v16H0z"></path>
                  </defs>
                  <g>
                    <mask id="add_svg__b" fill="#fff">
                      <use xlink:href="#add_svg__a"></use>
                    </mask>
                    <g mask="url(#add_svg__b)">
                      <path transform="translate(1.333 1.333)"
                        d="M13.33 6.67A6.66 6.66 0 0 0 6.67 0C2.98 0 0 2.98 0 6.67a6.66 6.66 0 0 0 6.67 6.66c3.68 0 6.66-2.98 6.66-6.66Z"
                        style="stroke: rgb(51, 51, 51); stroke-width: 1.33333; stroke-opacity: 1; stroke-dasharray: 0, 0;">
                      </path>
                      <path transform="translate(8 5.333)" d="M0 0v5.33"
                        style="stroke: rgb(51, 51, 51); stroke-width: 1.33333; stroke-opacity: 1; stroke-dasharray: 0, 0;">
                      </path>
                      <path transform="translate(5.333 8)" d="M0 0h5.33"
                        style="stroke: rgb(51, 51, 51); stroke-width: 1.33333; stroke-opacity: 1; stroke-dasharray: 0, 0;">
                      </path>
                    </g>
                  </g>
                </svg></div>
              <div class="button_icon-button-text__m50dB">新的聊天</div>
            </div>
          </div>
        </div>
      </div>


      <div class="home_window-content__h3Yin">
        <div class="home_chat__LX3xe">
          <div class="home_window-header__aWrLQ">
            <div class="home_window-header-title__4JrZX">
              <div class="home_window-header-main-title__cAbcz">新的聊天</div>
              <div class="home_window-header-sub-title__9Gyhf">与 AI聊天 GPT 的 1 条对话</div>
            </div>
            <div class="home_window-actions__pQt9J">
              <div class="home_window-action-button__jEEks home_mobile__JfFJ9">
                <div class="button_icon-button___a_E9 button_border__8t_DM button_shadow__kLcUJ  clickable undefined"
                  title="查看消息列表" role="button">
                  <div class="button_icon-button-icon__3y7OZ false"><svg xmlns="http://www.w3.org/2000/svg"
                      xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" fill="none">
                      <defs>
                        <path id="menu_svg__a" d="M0 0h16v16H0z"></path>
                      </defs>
                      <g>
                        <mask id="menu_svg__b" fill="#fff">
                          <use xlink:href="#menu_svg__a"></use>
                        </mask>
                        <g mask="url(#menu_svg__b)">
                          <path transform="translate(2.65 3.983)" d="M0 0h10.67"
                            style="stroke: rgb(51, 51, 51); stroke-width: 1.33333; stroke-opacity: 1; stroke-dasharray: 0, 0;">
                          </path>
                          <path transform="translate(2.65 7.983)" d="M0 0h10.67"
                            style="stroke: rgb(51, 51, 51); stroke-width: 1.33333; stroke-opacity: 1; stroke-dasharray: 0, 0;">
                          </path>
                          <path transform="translate(2.65 11.983)" d="M0 0h10.67"
                            style="stroke: rgb(51, 51, 51); stroke-width: 1.33333; stroke-opacity: 1; stroke-dasharray: 0, 0;">
                          </path>
                        </g>
                      </g>
                    </svg></div>
                </div>
              </div>
              <div class="home_window-action-button__jEEks">
                <div class="button_icon-button___a_E9 button_border__8t_DM button_shadow__kLcUJ  clickable undefined"
                  role="button">
                  <div class="button_icon-button-icon__3y7OZ false"><svg xmlns="http://www.w3.org/2000/svg"
                      xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" fill="none">
                      <defs>
                        <path id="rename_svg__a" d="M0 0h16v16H0z"></path>
                      </defs>
                      <g>
                        <mask id="rename_svg__b" fill="#fff">
                          <use xlink:href="#rename_svg__a"></use>
                        </mask>
                        <g mask="url(#rename_svg__b)">
                          <path transform="translate(1.775 1.3)" d="M2.83 13.2 13.2 2.83 10.37 0 0 10.37v2.83h2.83Z"
                            style="stroke: rgb(51, 51, 51); stroke-width: 1.33333; stroke-opacity: 1; stroke-dasharray: 0, 0;">
                          </path>
                          <path transform="translate(9.317 4.13)" d="m0 0 2.83 2.83"
                            style="stroke: rgb(51, 51, 51); stroke-width: 1.33333; stroke-opacity: 1; stroke-dasharray: 0, 0;">
                          </path>
                        </g>
                      </g>
                    </svg></div>
                </div>
              </div>
              <div class="home_window-action-button__jEEks">
                <div class="button_icon-button___a_E9 button_border__8t_DM button_shadow__kLcUJ  clickable undefined"
                  title="导出聊天记录" role="button">
                  <div class="button_icon-button-icon__3y7OZ false"><svg xmlns="http://www.w3.org/2000/svg"
                      xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" fill="none">
                      <defs>
                        <path id="export_svg__a" d="M0 0h16v16H0z"></path>
                      </defs>
                      <g>
                        <mask id="export_svg__b" fill="#fff">
                          <use xlink:href="#export_svg__a"></use>
                        </mask>
                        <g mask="url(#export_svg__b)">
                          <path transform="translate(1.24 2.333)"
                            d="M12.27 9.11a3.09 3.09 0 0 0 1.16-3.44c-.41-1.28-1.65-1.98-2.99-1.98h-.77A4.924 4.924 0 0 0 5.47.03C3.45-.2 1.5.84.56 2.64c-.94 1.81-.67 4 .67 5.53"
                            style="stroke: rgb(51, 51, 51); stroke-width: 1.33333; stroke-opacity: 1; stroke-dasharray: 0, 0;">
                          </path>
                          <path transform="translate(8 7.667)" d="M0 6V0"
                            style="stroke: rgb(51, 51, 51); stroke-width: 1.33333; stroke-opacity: 1; stroke-dasharray: 0, 0;">
                          </path>
                          <path transform="translate(5.879 11.545)" d="M4.24 0 2.12 2.12 0 0"
                            style="stroke: rgb(51, 51, 51); stroke-width: 1.33333; stroke-opacity: 1; stroke-dasharray: 0, 0;">
                          </path>
                        </g>
                      </g>
                    </svg></div>
                </div>
              </div>
            </div>
          </div>

          <div class="home_chat-body__Jbfri">
            <!--初始消息-->
            <div class="home_chat-message__ahN5d">
              <div class="home_chat-message-container__zupsx">
                <div class="home_chat-message-avatar__HOnBk">
                  <div class="home_user-avtar__ngMiw"><img alt="Bot Icon" loading="lazy" width="500" height="300"
                      decoding="async" data-nimg="1" class="home_user-avtar__ngMiw" src="../../assets/logo.png"
                      style="color: transparent;"></div>
                </div>
                <div class="home_chat-message-item__xQRUB">
                  <div class="markdown-body">
                    <p>有什么可以帮你的吗</p>
                  </div>
                </div>
                <div class="home_chat-message-actions__BgEM2">
                  <div class="home_chat-message-action-date__l_ylm">8/21/2023, 1:34:28 AM</div>
                </div>
              </div>
            </div>
            
            <!--开始输出对话信息-->
            
            <!--用户消息-->
            <div  :class="item.role === 'user' ? 'home_chat-message-user__ikda2': 'home_chat-message__ahN5d'" v-for="(item) in conversations" :key="item.index">
              <div class="home_chat-message-container__zupsx">
                <div class="home_chat-message-avatar__HOnBk">
                  <div class="home_user-avtar__ngMiw"><img
                      src="https://cdn.jsdelivr.net/npm/emoji-datasource-apple/img/apple/64/1f603.png" alt="smiley"
                      class="__EmojiPicker__ epr-emoji-img" loading="eager"
                      style="font-size: 18px; height: 18px; width: 18px;"></div>
                </div>
                <div class="home_chat-message-item__xQRUB">
                  <div class="markdown-body">
                    <p>{{ item.content }}</p>
                  </div>
                </div>
              </div>
            </div>

            <div style="opacity: 0; height: 2em;">-</div>
          </div>


          <div class="home_chat-input-panel__MB6VZ">
            <div class="home_chat-input-actions__N8uAU">
              
            </div>
            <div class="home_chat-input-panel-inner__3cH6E"><textarea v-model="userInputValue" class="home_chat-input__3tOh5"
                placeholder="/请输入你的对话" rows="3"></textarea>
              <div
                class="button_icon-button___a_E9 button_border__8t_DM button_shadow__kLcUJ home_chat-input-send__8OpUT no-dark clickable undefined"
                role="button">
                <div class="button_icon-button-icon__3y7OZ false"><svg xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16" fill="none">
                    <defs>
                      <path id="send-white_svg__a" d="M0 0h16v16H0z"></path>
                    </defs>
                    <g>
                      <mask id="send-white_svg__b" fill="#fff">
                        <use xlink:href="#send-white_svg__a"></use>
                      </mask>
                      <g mask="url(#send-white_svg__b)">
                        <path transform="translate(1.333 2)" d="M0 4.71 6.67 6l1.67 6.67L12.67 0 0 4.71Z"
                          style="stroke: rgb(255, 255, 255); stroke-width: 1.33333; stroke-opacity: 1; stroke-dasharray: 0, 0;">
                        </path>
                        <path transform="translate(8.003 6.117)" d="M0 1.89 1.89 0"
                          style="stroke: rgb(255, 255, 255); stroke-width: 1.33333; stroke-opacity: 1; stroke-dasharray: 0, 0;">
                        </path>
                      </g>
                    </g>
                  </svg></div>
                <div class="button_icon-button-text" v-on:click="doConversation">发送</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>

export default {

  data() {
    return {
      userInputValue: '',
      conversations: [
      ]
    }
  },
  methods: {

    async doConversation() {
      var contentText = this.userInputValue;
      this.userInputValue = '';
      var conversationObj = {
        'role': 'user',
        'content': contentText,
      }

      this.conversations.push(conversationObj);

      var dataConversation = this.conversations.slice(-3);
      var data = {
        'model': 'general',
        "stream":true, 
        "source":"openai",
        "conversations": dataConversation
      }

      console.log(JSON.stringify(data))
      const response = await fetch('http://43.139.163.100:8080/conversation', {
        method: "post",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data)
      });

      const reader = response.body.getReader();
      const decoder = new TextDecoder()
      let result = await reader.read()
      var hasAdd = false;
      var assistantObj = {};
      while (!result.done) {
        const text = decoder.decode(result.value)
        if (hasAdd) {
          var e = this.conversations[this.conversations.length - 1];
          var newStr = e.content.concat(text);
          this.conversations[this.conversations.length - 1].content = newStr;
        } else {
          assistantObj.role = 'assistant';
          assistantObj.content = text;
          this.conversations.push(assistantObj);
          hasAdd = true;
        }
        result = await reader.read()
      }
    }

  },
};
</script>

<style scoped>@import url('../../assets/main.css')</style>
